% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mnase_correct_single_matrix.R
\name{mnase_correct_single_matrix}
\alias{mnase_correct_single_matrix}
\title{Correct MNase Bias in a Single Matrix}
\usage{
mnase_correct_single_matrix(
  data_mat,
  sample_num = NULL,
  bias_mat = NULL,
  snr_filter = F,
  single_model_cores = parallel::detectCores(),
  dtthreads = parallel::detectCores(),
  correction_type = "ratio",
  pre_computed_model = NULL,
  save_model_loc = NULL
)
}
\arguments{
\item{data_mat}{A matrix containing the raw data (e.g., counts) to be corrected.}

\item{sample_num}{An optional integer specifying the number of samples to use from the data matrix. 
If `NULL`, all data will be used for fitting the model.}

\item{bias_mat}{An optional matrix of MNase bias values. If `NULL`, a default bias matrix will be loaded 
from the \code{basepairC} package.}

\item{snr_filter}{A logical value indicating whether to apply an SNR filter. Defaults to \code{FALSE}.}

\item{single_model_cores}{An integer specifying the number of cores to use for parallelization 
in model fitting. Defaults to the number of detected cores.}

\item{dtthreads}{An integer specifying the number of threads to use for \code{data.table} operations. 
Defaults to the number of detected cores.}

\item{correction_type}{A string specifying the type of correction to apply. Options are \code{"ratio"} 
or \code{"residual"}. Defaults to \code{"ratio"}.}

\item{pre_computed_model}{An optional pre-computed GAM model. If provided, the model will be used 
instead of fitting a new one.}

\item{save_model_loc}{An optional string specifying the file path to save the fitted GAM model. 
If \code{NULL}, the model will not be saved.}
}
\value{
A matrix with the same dimensions as \code{data_mat}, containing the corrected values. 
The returned matrix includes the GAM model as an attribute \code{"gam_model"}.
}
\description{
This function corrects MNase bias in a single data matrix using a GAM model fit to the data. 
The function can use pre-computed bias matrices or a provided model and includes options for 
parallelization and model saving.
}
\details{
The function melts the input data and bias matrices to long format and merges them for analysis. 
A GAM model is fit to the merged data using \code{mgcv::gam}, with optional bootstrapping to 
determine starting values for the model coefficients. The data can be corrected using either a 
ratio or residual-based approach, depending on the \code{correction_type} argument.
}
\examples{
\dontrun{
# Correct a data matrix using the default bias matrix and all available cores
corrected_matrix <- mnase_correct_single_matrix(data_mat = my_data_matrix)

# Use a subset of the data for model fitting
corrected_matrix <- mnase_correct_single_matrix(data_mat = my_data_matrix, sample_num = 10000)

# Use a pre-computed model and save the new model to a file
corrected_matrix <- mnase_correct_single_matrix(
  data_mat = my_data_matrix, 
  pre_computed_model = my_precomputed_model, 
  save_model_loc = "path/to/save_model.rds"
)
}

}
